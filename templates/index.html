import isodate

# 获取随机视频列表的函数
def get_random_videos(channel_id):
    try:
        url = f'https://www.googleapis.com/youtube/v3/search?part=snippet&channelId={channel_id}&maxResults=50&order=date&type=video&key={API_KEY}'
        response = requests.get(url).json()

        if 'items' not in response:
            return []
        
        videos = response['items']
        random_videos = random.sample(videos, min(10, len(videos)))  # 随机选择10个视频
        video_ids = ','.join([video['id']['videoId'] for video in random_videos])

        # 获取视频的详细信息
        video_details_url = f'https://www.googleapis.com/youtube/v3/videos?part=contentDetails,snippet&id={video_ids}&key={API_KEY}'
        details_response = requests.get(video_details_url).json()

        # 处理视频信息，并将持续时间转换为标准时间格式
        video_data = []
        for video in details_response['items']:
            duration_iso = video['contentDetails']['duration']  # ISO 8601格式的持续时间
            parsed_duration = isodate.parse_duration(duration_iso)

            # 转换为 HH:MM:SS 格式
            hours, remainder = divmod(parsed_duration.total_seconds(), 3600)
            minutes, seconds = divmod(remainder, 60)
            formatted_duration = f"{int(hours):02}:{int(minutes):02}:{int(seconds):02}"

            video_data.append({
                'title': video['snippet']['title'],
                'description': video['snippet']['description'],
                'duration': formatted_duration,
                'videoId': video['id']
            })

        return video_data
    except requests.RequestException as e:
        print(f"Error fetching videos: {e}")
        return []
